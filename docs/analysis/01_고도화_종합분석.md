# BatteryDataTool 고도화 종합 분석

> 작성일: 2026-01-14  
> 분석 대상: `python_code/dataprocess/BatteryDataTool.py`

---

## 1. 현재 시스템 분석

### 1.1 코드 규모

| 파일                    | 크기  | 라인 수  | 함수/메서드      |
| ----------------------- | ----- | -------- | ---------------- |
| `BatteryDataTool.py`    | 832KB | 14,158줄 | 239개            |
| `BatteryDataTool_UI.py` | 317KB | -        | UI 코드          |
| `BatteryDataTool_UI.ui` | 556KB | -        | Qt Designer 파일 |

### 1.2 현재 기능

| 탭                      | 기능                             | 연산 특성      |
| ----------------------- | -------------------------------- | -------------- |
| **사이클 데이터**       | 충방전기 데이터 로드/분석/시각화 | I/O 중심       |
| **dV/dQ 분석**          | 양음극 피팅, 열화 정량화         | 🔴 연산 집약적 |
| **EU/승인/실수명 예측** | 경험적 모델 기반 수명 예측       | 🔴 연산 집약적 |

### 1.3 기술 스택

```
현재 스택:
├── Python 3.x
├── PyQt5 (UI)
├── pandas, numpy (데이터 처리)
├── scipy.optimize.curve_fit (피팅)
├── matplotlib (시각화)
└── pyodbc (데이터베이스)
```

---

## 2. 고도화 방향 분석

### 2.1 성능 최적화

#### Python vs Julia 비교

| 기준               | Python + Numba     | Julia           |
| ------------------ | ------------------ | --------------- |
| **피팅 연산 속도** | 10-20x 향상        | 20-50x 향상     |
| **구현 난이도**    | ⭐⭐ (낮음)        | ⭐⭐⭐⭐ (높음) |
| **기존 코드 통합** | ⭐⭐⭐⭐⭐         | ⭐⭐            |
| **PyBaMM 호환**    | ✅ 완벽 호환       | ❌ 미지원       |
| **PINN 생태계**    | ✅ PyTorch/DeepXDE | ⚠️ 제한적       |

#### 권장: Python 유지 + Numba 최적화

```python
# Numba 최적화 예시
from numba import njit, prange

@njit(parallel=True, fastmath=True)
def capacityfit_numba(x_cycle, x_temp, a, b, b1, c, d, e, f, fd):
    n = len(x_cycle)
    result = np.empty(n)
    for i in prange(n):
        term1 = np.exp(a * x_temp[i] + b) * (x_cycle[i] * fd) ** b1
        term2 = np.exp(c * x_temp[i] + d) * (x_cycle[i] * fd) ** (e * x_temp[i] + f)
        result[i] = 1.0 - term1 - term2
    return result
```

### 2.2 UI 현대화

| 옵션                | 장점              | 단점              | 권장    |
| ------------------- | ----------------- | ----------------- | ------- |
| **PyQt5 유지**      | 기존 자산 활용    | 개발 속도 느림    | 단기    |
| **Streamlit**       | 빠른 프로토타입   | 커스터마이징 제한 | ✅ 중기 |
| **Dash/Plotly**     | 인터랙티브 시각화 | 복잡한 UI 어려움  | 중기    |
| **React + FastAPI** | 완전한 확장성     | 개발 비용 높음    | 장기    |

### 2.3 전기화학 관점 필수 기능

#### 현재 구현됨 ✅

- Cycle data 분석 (용량, 효율, DCIR)
- dV/dQ (IC/DV) 분석
- 경험적 수명 예측

#### 추가 필요 🔵

**열화 메커니즘 분석:**

- SEI 성장 모델링
- 리튬 플레이팅 감지/예측
- 캐소드 구조 열화 (크랙, 상전이)

**임피던스 분석:**

- EIS 피팅 (Randles 등가회로)
- DRT (Distribution of Relaxation Times)

**열역학 분석:**

- OCV-SOC 곡선 모델링
- 엔트로피/엔탈피 해석

---

## 3. PyBaMM 통합 계획

### 3.1 PyBaMM 개요

PyBaMM (Python Battery Mathematical Modelling)은 물리 기반 배터리 시뮬레이션의 표준 도구.

### 3.2 통합 이점

| 기능          | 현재 (경험적) | PyBaMM 통합 후     |
| ------------- | ------------- | ------------------ |
| 열화 예측     | 데이터 기반   | 물리 기반 + 데이터 |
| 파라미터 의미 | 피팅 상수     | 물리적 의미        |
| 외삽 능력     | 제한적        | 다양한 조건 예측   |
| What-if 분석  | 불가          | 가능               |

### 3.3 통합 시나리오

```
┌─────────────────────────────────────────────┐
│           PyBaMM Integration                 │
├─────────────────────────────────────────────┤
│  1. 시뮬레이션 엔진으로 활용                 │
│     - SPM/DFN 모델 실행                      │
│     - 다양한 운전 조건 시뮬레이션            │
│                                              │
│  2. 파라미터 추정                            │
│     - 실험 데이터 피팅                       │
│     - 물리 파라미터 추출                     │
│                                              │
│  3. 가상 데이터 생성                         │
│     - PINN 학습용 데이터 증강                │
│     - 다양한 시나리오 시뮬레이션             │
└─────────────────────────────────────────────┘
```

---

## 4. PINN 수명예측 계획

### 4.1 PINN 개요

Physics-Informed Neural Network (PINN)은 물리 법칙을 신경망 학습에 통합.

### 4.2 배터리 수명 예측에서 PINN의 장점

1. **데이터 효율성** - 적은 실험 데이터로 일반화
2. **물리적 일관성** - 비현실적 예측 방지
3. **해석 가능성** - 물리 파라미터 추출
4. **외삽 능력** - 학습 범위 외 조건 예측

### 4.3 구현 계획

```python
# PINN 손실 함수 예시
def physics_loss(model, x, t, T):
    """
    물리 손실: Arrhenius 온도 의존성 + SEI 성장

    dC/dt = -A * exp(-Ea/RT) * f(SOC, C-rate)
    """
    # 데이터 손실
    pred = model(x)
    data_loss = mse(pred, y_true)

    # 물리 손실 (자동 미분)
    dC_dt = grad(model, t)
    arrhenius = A * torch.exp(-Ea / (R * T))
    physics_loss = mse(dC_dt, -arrhenius * f(x))

    return data_loss + lambda_phys * physics_loss
```

### 4.4 기술 스택

| 라이브러리  | 용도                 | 비고            |
| ----------- | -------------------- | --------------- |
| **PyTorch** | 딥러닝 프레임워크    | GPU 가속        |
| **DeepXDE** | PINN 전문 라이브러리 | 빠른 프로토타입 |
| **PyBaMM**  | 가상 데이터 생성     | 사전학습용      |

---

## 5. 권장 아키텍처

### 5.1 폴더 구조

```
processTool_dev/
├── python_code/dataprocess/     # 원본 (수정 안 함)
│
├── battery_analysis_v2/         # 고도화 버전 (신규)
│   ├── core/                    # 핵심 계산 엔진
│   │   ├── data_loader/         # 데이터 로드
│   │   ├── cycle_analysis/      # 사이클 분석
│   │   ├── dvdq_analysis/       # dV/dQ 분석
│   │   └── life_prediction/     # 수명 예측
│   │       ├── empirical/       # 경험적 모델
│   │       ├── physics_based/   # PyBaMM
│   │       └── ml_based/        # PINN
│   │
│   ├── pybamm_integration/      # PyBaMM 래퍼
│   ├── pinn_engine/             # PINN 모듈
│   ├── api/                     # FastAPI 백엔드
│   ├── ui/                      # 프론트엔드
│   └── tests/                   # 테스트
│
└── docs/analysis/               # 분석 문서
```

### 5.2 시스템 아키텍처

```
┌─────────────────────────────────────────────┐
│              Frontend                        │
│  Streamlit (프로토타입) → React (장기)       │
└───────────────┬─────────────────────────────┘
                │ REST API
┌───────────────▼─────────────────────────────┐
│              Backend (FastAPI)               │
├──────────────────────────────────────────────┤
│  Core Engine    │  Physics     │  ML/AI     │
│  (Numba 최적화) │  (PyBaMM)    │  (PINN)    │
│  - Cycle분석    │  - SPM/DFN   │  - PyTorch │
│  - dV/dQ        │  - 파라미터  │  - DeepXDE │
│  - 경험적모델   │    추정      │            │
└──────────────────────────────────────────────┘
```

---

## 6. 단계별 로드맵

### Phase 1: 기반 구축 (1-2개월)

- [ ] 코드 모듈화 (14,000줄 → 모듈 분리)
- [ ] Numba 최적화 적용
- [ ] 단위 테스트 작성
- [ ] API 인터페이스 설계

**성과:** 5-10배 속도 향상

### Phase 2: PyBaMM 통합 (2-3개월)

- [ ] PyBaMM 래퍼 모듈 개발
- [ ] SPM/DFN 시뮬레이션 연동
- [ ] 파라미터 추정 기능

**성과:** 물리 기반 열화 분석

### Phase 3: PINN 수명예측 (3-4개월)

- [ ] PINN 모델 아키텍처 설계
- [ ] Physics loss 함수 구현
- [ ] 학습 파이프라인 구축

**성과:** AI 기반 수명 예측

### Phase 4: UI 현대화 (2-3개월)

- [ ] Streamlit 프로토타입
- [ ] 핵심 기능 웹앱화

### Phase 5: 고급 기능 (지속)

- [ ] EIS 분석 모듈
- [ ] DRT 분석
- [ ] 자동 리포트 생성

---

## 7. 결론

### 핵심 권장사항

1. **언어 선택:** Julia 전체 마이그레이션 ❌ → Python 유지 + Numba 최적화 ✅
2. **이유:** PyBaMM, PINN 생태계가 Python 기반
3. **성능:** Numba로 10-20배 향상 가능
4. **UI:** Streamlit으로 시작 → React로 발전
5. **작업 방식:** 원본 보존, 새 폴더에서 작업

### 우선순위

| 순위 | 작업         | 효과 | 난이도 |
| ---- | ------------ | ---- | ------ |
| 1    | Numba 최적화 | 높음 | 낮음   |
| 2    | 코드 모듈화  | 중간 | 중간   |
| 3    | PyBaMM 통합  | 높음 | 중간   |
| 4    | PINN 구현    | 높음 | 높음   |
| 5    | UI 현대화    | 중간 | 중간   |
